---
layout: post_page
title: Chapter 1
---
# Chapter 1: Performance *simply* matters

We have grown ourselves into a society of instantness and impatience. Today, waiting is not an option. We live in a culture of "survival of the fastest". Search engines like Google, Bing and Yahoo are competing to offer the fastest and best search results. e-Commerce sites like Amazon, Target and Walmart are competing with innovative delivery methods such as same-day deliveries or drones. Seasonal events such as Christmas or Black Friday are the judgement days for performance optimization, competing with others to see who can put your selected items in their online cards faster. Our everyday life is more and more moving towards an online life, where slow is not an option. We've come to a point where almost everything we need to do, accomplish or purchase can be done online, especially if we want it fast or instantaneously; from ordering food to buying stamps, or even finding relationships. If one of those online experiences feels slow to us, we will probably complain to the site, our friends and on social media, and might not visit these websites again but rather move on to find alternatives.

Although internet speeds have increased, websites are getting bigger in size and more complex by the year, and so websites inevitably need to be powered by better and stronger technologies to satisfy the impatient users of today. But why is the overall size of websites getting larger? Are we overloading our sites? Are we getting lazy and taking current high-speed infrastructures for granted, not caring anymore about clean, lean and performant code? Does technology allows us to slack for perfection and optimization? Maybe technology allows us to go bigger but maybe not necessarily better when it comes to performance. Servers, internet connections and their pipes are getting more sophisticated, and as a result, we feel the need to keep filling them. However, this shouldn't be the time to become lazy, this is the time to make use of all the amazing research and tools out there to make websites faster and finally to learn how to improve user experience and satisfaction. Because nobody likes to wait.

Figure 1 and 2 show the trend for the size and requests of websites and how both metrics have increased over the years. From 2010 to 2014, the average total transfer size of a website increased by 150%, compared to total number of requests which only increased by around 16%. We can clearly see a trend towards more complex web applications. Our code needs to be performant to handle the rise of sophisticated applications.

AB: requests of websites -> number of requests?  total transfer size and request count: is that up to the load event?

BB: not sure what you mean by that, I cleaned up the images and title, I hope that helps. Did you want me to clarify what the relation is between bigger sites and the load event?

 ![Figure 1 ](images/1-http-requests-increase.png)
 *Source: HTTP Archive, values taken from mid-January of [each year](https://docs.google.com/spreadsheets/d/1T54HtDPl7utozPaUrhAoxnItUygST1oh7s4poMluhKY/edit?usp=sharing)*

 ![](images/1-http-filesize-increase.png)
*Source: HTTP Archive, values taken from mid-January of [each year](https://docs.google.com/spreadsheets/d/1T54HtDPl7utozPaUrhAoxnItUygST1oh7s4poMluhKY/edit?usp=sharing)*

SM: The above could possibly go in a preface, and chapter 1 could start with the below, or a more concise version of the above.
BB: I'm ok with turning this into a preface, we can probably decide this later?

##A lean website

The book *Lean Websites* focuses on examining the causes for bloated and slow websites, dissects which assets of your page are necessary, which ones are nice to have, and some that are not necessary at all and can be removed to shed off some weight. This book helps you to understand what causes slow websites and how to look for efficiency while maintaining the quality of your website that you originally envisioned.

As you might have already figured out by now, the title of the book includes the word *lean*. So what does the word *lean* mean?

The word lean also is being used in the context of manufacture. The idea of lean means there is to stay focused on the important things that matter while removing any barriers or heaviness that could slow down the creation of the product.
The principle of lean is to focus on the obvious pieces that add value to a product (a website) while reducing everything else that doesn't.

However I want to point out another meaning to the word lean in the context of this book; as in real life, we know that exercising keeps us healthy. If we practice and focus on health, we will be more productive, faster, and responsive. And as with any routine in life but once established, you don't really think about it. The more we exercise and practice the act of building healthy and not heavy websites, the more this will convert into a routine, which hopefully will become part of your DNA when deploying websites. 

And for now, to set your expectations up front: The bad news is there is so much you can do wrong and probably are doing wrong when it comes to building websites from a performance perspective. But, hey, there is also the good news: there are so many options and tools out there today that make it relatively easy to fix those problems.

>"The secret of getting ahead is getting started." -- Agatha Christie

Shall we? Are you ready? Let's get started!


## The psychology of speed and web performance

So why do people leave a website? Of course, there could be many reasons, e.g. they didn't find what they were looking for, or it took too long for the website to load. Based on previously mentioned studies, there is a good chance that users left your site because it was too slow, perhaps it took too long to order online from your site and hence the delivery of your service was to slow. In this section, I want to draw some attention to psychology and how it plays a big role in how we perceive speed and performance.

### What is “too slow” and when do websites "feel" slow?

>[Time doesn't fly when we are having fun](http://www.spring.org.uk/2011/06/10-ways-our-minds-warp-time.php)

When do we experience fun? Clearly, it's not when we have to wait. Who likes to wait, especially in this world of constant news and response? The time of being patient is over, people desire instant satisfaction and have very little patience. Amazon offers one-day delivery; calling a cab shouldn't take longer than ten minutes. We've become a society where waiting is not acceptable anymore; the faster you get something, the more likely it is that you will use and recommend the service to your friends and others. This is not any different when we visit websites. People require instantness, especially when it comes to the online world. If the user doesn't get instant respond from the website, moving on to a competitor's site to retrieve the same information is just a click away.

>[Minutes drag when we are bored](http://www.theguardian.com/science/2013/jan/01/psychology-time-perception-awareness-research)

If we are entertained and don't have to wait, we barely notice if something takes too much time, for example think about TVs in elevators, or bars while we wait for our friends. 

The problem with all the above is that perception of speed is very subjective and very context specific. What feels slow to me, might not feel slow to say, my father or my grandmother. We all have different expectations. For this reason, chapter 3 will help us put real numbers and data to the definition of "too slow" as those metrics determine what makes users potentially decide to leave your site.


### Maister's first law of service

David Maister, a former professor at the Harvard Business School came up with the following formula for the law of service.

[`Satisfaction = Perception - Expectation`](faculty.haas.berkeley.edu/andy/blockhandouts/Queue%20Psychology.ppt)

In the context of web performance and serving content to visitors of your site, this could be broken down into the following items:

* What was actually served and presented to the visitor
* What was perceived by the visitor
* What the visitor actually expected


#### Satisfaction (and respect)
Your website visitor is satisfied when their perception is greater than their expectation. Imagine the example where you visit a page and the loading indicator slowly moves from 5% to 10%, you will think it will take a while before it hits 100%. However, next time you look at the screen, the percentage went already up to 95% and soon to 100%. You are satisfied and happy because your perception was greater than your expectation. You did *not* expect it to go so fast.
However, if the loading indicator goes up slower than you expected, you will experience an unpleasant feeling; when expectation is greater than perception, the visitor is not satisfied.

I'd like to add 'respect' to the formula as I believe satisfaction also results from respect, because ultimately, performance is about respect. [Brad Frost](http://bradfrostweb.com/blog/post/performance-as-design/) and [Tim Kadlec](http://timkadlec.com/2013/01/setting-a-performance-budget/) have talked about this as well. If you perceive that service is (intentionally) slow, you feel some anger or discomfort in you. What would you do if you stood in line for 20 minutes only to find out right before you are the next in line that the cashier closes. Frustrating, right? Couldn't they have told you earlier? That's where respect comes into play, the higher the respect is, the more likely satisfaction will be. Respect could have been shown by informing people in the lineup early on when the cashier closes.

SM: I think you need to be clear about how respect is included here. Do you just mean Satisfaction + respect = Perception - expectation 
BB: It's more like: Satisfaction = (Perception - Expectation) + Respect
I added a few more lines above to clarify. Let me know if you want me to add the revised formula  as follows (I personally think it confused the user more)

`Satisfaction = (Perception - Expectation) + Respect`

#### Perception
We need to acknowledge that speed and the perception of it is a feeling, something that is very subjective to the person.

The [perception of slow](http://www.slideshare.net/stoyan/psychology-of-performance) is mostly associated with negative feelings like: unpleasant, unknown or boring. Meanwhile, fast is described as a task that has been executed successfully, it appears to be a responsive system, and the user is kept in the loop of the progress, of what's going on.

Here is a great [example](http://www.nytimes.com/2012/08/19/opinion/sunday/why-waiting-in-line-is-torture.html?pagewanted=all&_r=0) for perception: The Houston airport received a lot of complaints from passengers that it took too long to get their luggage. Instead of making those hard working airport personnel work even faster to get the luggage out, the airport decided to change the way passengers perceived the waiting time to pick up their luggage. How did they do that? They extended the distance from the arrival gate to the baggage claim by six times, so by the time the passengers arrived at the baggage claim, six minutes had passed. While the airport personnel were busy moving all the luggage to the baggage claim, passengers were kept busy in the meantime, by walking. The time for the bags to come out hadn't changed.

#### Expectations
In the context of performance, it's about managing expectations. Disney has done a fabulous job in managing expectations so the customer receives a positive outcome in their amusement parks. They have lineups that show you the expected waiting times, with a rather pessimistic estimate  and in reality the time to get in front of the line is much shorter than predicted. What's the result? The customer feels they got an advantage of choosing this line and time of the day, and therefore feel more positive.

###  Abandon rate: When your user decides to leave
We've all abandoned a service before. Standing in line and noticing it doesn't move at all make us impatient until we give up and quit; we leave the queue and don't finish the task we actually wanted to accomplish. Frustration, disappointment, and dislike builds up.
The same can happen for websites. The abandon rate is probably the safest and most honest judgement you can get from your users. Even if the website loads fast, it's also the abandon rate that defines failure or success. Based on a study, a user who visits your site, experiences page load time [15% slower](http://www.webperformancetoday.com/2010/06/15/everything-you-wanted-to-know-about-web-performance) than it actually is. For example, your website loads in 5 seconds, for the user it feels 15% slower, that's 0.75 seconds. Based on this research, your user will experience the load time of your website almost 1 second slower than it actually is.

There are many statistics and case studies out there that prove abandon behaviour of users due to poor performance. e-Commerce websites are hit the hardest. Big competition forces them to pay close(r) attention to speed and execution. If your shopping cart doesn't load fast enough, your users might just take there "stuff" and move to a competitor of yours.

Here are some [real-world statistics and numbers](http://www.webperformancetoday.com/2010/06/15/everything-you-wanted-to-know-about-web-performance/) that prove how important speed is in a world of invaluable instantness:

* Amazon's calculated that a page load slowdown of just one second could cost them $1.6 billion in sales [each year](http://www.fastcompany.com/1825005/how-one-second-could-cost-amazon-16-billion-sales), having their service down for 1 hour would cost them $1 million ([NYT 2008](http://www.slideshare.net/bitcurrent/metrics-101))
* Almost 40% of online shoppers abandon a website that takes more than 3 seconds to load ([Gomez](http://www.mcrinc.com/Documents/Newsletters/201110_why_web_performance_matters.pdf))
* 79% of online shoppers will not return to a website after a disappointing experience due to poor performance ([KissMetrics](https://blog.kissmetrics.com/loading-time/?wide=1))
* A 1-second delay in page load time equals 11% fewer page views, a 16% decrease in customer satisfaction, and 7% loss in conversions ([Aberdeen Group](http://www.aberdeen.com/research/5136/ra-performance-web-application/content.aspx))


BB: cleaned this up a bit, considering AB's comments - Thanks

### Reaction time

Perceived web performance deals with the phenomenon of how we experience response from a system and our human perception to it.

AB: I immediately think "not just response time", after all render time is important too.

BB: Response time here means reaction time (and has nothing to do with response, render etc of content in the browser), I changed it, I hope that's clearer

The following graph shows reaction time and how our brain deals with them, resulting in different emotions and reactions to what is presented to us.

![](images/1-perceived-web-performance.png)
*Perceived performance by ms and how our brain reacts, [source](http://www.webperformancetoday.com/2014/07/16/eight-tricks-improve-perceived-web-performance/) and [source](http://chimera.labs.oreilly.com/books/1230000000545/ch10.html#SPEED_PERFORMANCE_HUMAN_PERCEPTION)*

* We feel **instant perception** around a **100ms** delay
* A **slight perceptible delay** occurs between **100ms and 300ms**
* We definitely feel a **perceptible delay** under **1000ms** (1s)
* After **1 second**, we feel that a **mental context switch** starts
* After **10 seconds** and more, the **abandon rate** goes up and the user tends to leave the site

[NOTE]Mental context switch happens when the user stops engaging with their actual intention coming to the site. They most likely are not interested anymore in finishing their initial task triggered by less attention[END NOTE]


BB: moved mental context in note element as suggested by SM

While each user will have a different tolerance for delay, we can expect a scale of perception for a *typical* user based on above referenced data.

The research really outlines the need to avoid any kind of delay as much as possible. Ilya Grigorik, a web performance advocate at Google, calls it the 1000ms to [glass challenge](https://www.igvita.com/slides/2013/io-pagespeed.pdf). In order to fully satisfy your user's expectation, you have around 1000ms from your server to the user's glass (screen) to show your content.

If you want to achieve a fast experience for your users, you need to understand what aspects could harm such a goal. There are several temptations for web developers that could negatively affect the performance. It's easy to use them but they come with a price. Let's have a look at some of the dangerous temptations.

## Dangerous temptations

SM: this feels a bit of a jump, going from talking about psychology and perception of speed (more general concepts) to specific practical issues. Maybe we need some bridging content in here?
BB: Added a few more lines to the previous paragraph

>[The pressure to give in to a desire for easy or immediate pleasure](http://www.merriam-webster.com/thesaurus/temptation)

As it is with food diets, we are always presented with temptations. Temptations are things that give us instant satisfaction, make us happy (for a short period of time), and seem easy to grab and to achieve. We also call them guilty pleasures. Only afterwards do we notice the negative impact that it could have. This section describes some of the temptations that you've probably faced in your web development journey; many likely sound familiar to you. Don't feel judged or bad, we all have done most of these things.


### Copy and paste

I am certain that we've all done the following in our developer lives: You need to quickly add something to a page, e.g. a slide show or anything that probably somebody else out there in the internet universe has already dealt with. So you type into your preferred search engine "web slideshow" and returned to you are hundreds of thousands of examples that are ready for you to *just* copy and paste. That was easy, wasn't it? Still, you never know if the discovered code could be useful or the opposite, even harmful for your site until you've tried it. The danger with "copy and paste" is that you might not need all the functionality that the creator had originally in mind. You basically trust somebody out there on the internet to give you performant code? Would you rather not check first if you need all the functionality or determine if the code is performant or not? Chapter 4 will help you differentiate between *copy and paste* and *copy and waste*.


### Pretty images and designs
Of course, a picture is worth a thousand words. This idea resonates especially with web designers the most; if it looks pretty, it will sell. Don't get me wrong, I'm all for user experience, design and especially aesthetics, but it has to be reasonable, and more importantly context-sensitive. There's no need to show everybody the high resolution version of the image if not needed. Be context sensitive, considerate and respectful. Don't fill your page with unnecessary heavy assets like images just because you don't know what else to put there. Trust me, none of your users on their mobile device while roaming wants to download a 2MB retina image.

Images remain the biggest performance culprits. They currently take up most of the file sizes and usage on the internet, as shown in the chart below.

![Median of content types](images/1-median-of-contenttypes.png)
*Figure: Median of different content types*

The temptation web developers face, especially when working under a lot of time pressure, is to just plug in big images, without considering whether to convert them into a more efficient image dimension or format.

We will discuss how to avoid this temptation and still deliver a quality website in chapter 5 when we talk about mobile optimization and images.

### Software development life cycle & optimize later

Temptation can also be accompanied by laziness. Quickly testing something out, telling yourself you'll optimize it later, is an invitation for forgetting such a task.

Nowhere in the common software development life cycle (SDLC) is performance optimization mentioned as part of the process. Normally this process is something that is saved for later. I would argue this doesn't have to apply to front-end web development. If there is a way to optimize before deployment, why not do it? As Ilya Grigorik said it "[performance is a feature](https://www.igvita.com/slides/2013/io-pagespeed.pdf)" and shouldn't be an after the fact or thought.

I will show you in chapter 4 how you can automate optimization and make it part of your deployment process with some easy-to-use and free tools.

###Plugins

Christian Heilmann, a web evangelist at Mozilla, calls it "[death by a thousand plugins](http://www.smashingmagazine.com/2012/11/13/the-vanilla-web-diet/)". It's so easy to attempt to use modern web development trends by including yet another plugin or library. We sometimes forget that anything you put on your page will cost you and your visitor when it comes to performance. Don't let too many plugins bloat your website. Heilmann also encourages us to remember that "it is not about what you can add — it is about what we can’t take away". Something to remember next time when you want to paste another plugin into your site.


#### Libraries and frameworks

Libraries like jQuery, Dojo, YUI, etc. are popular tools to help developers kick-start JavaScript projects, access JavaScript objects and methods faster and easier. It simplifies the coding experienced by offering you a toolkit to access and use the DOM and browser methods better. Even Twitter's Bootstrap promises easy web development. The issue with that is, that developers might become lazy, not knowing anymore how much traversing the DOM could cost.

![Big Query query](images/1-popular-libraries.png)
*Figure: most popular libraries*

The file size of these libraries may vary a lot, especially if they are not minified, gzipped and compressed; all techniques to reduce the file size and make their loading faster. I will talk more in detail about these methods in chapter 4. Just as an example, jQuery minified and compressed is almost eight times smaller than sending it over the wire without optimization (252 KB uncompressed, 32 KB minified and gzipped). So no matter what library or framework you decide to include, you should pay attention to how you include the asset.

Frameworks are kind of like code-template engines, aiming to help you build and structure your JavaScript application. Common JavaScript frameworks are MVC (Model-View-Controller) frameworks such as Backbone, AngularJS or Ember.js.

As a developer, you should decide what framework and library to use early on in your project. In general, it normally doesn't make sense to use more than one library or more than one MVC JavaScript framework with your code as different libraries tend to achieve the same goal, help you build faster and more organized.

There are several temptations that can arise when dealing with plugins, such as libraries and frameworks. Look at the table below.

| Website       	| Count   	| Different jQuery version loaded
| ------------- 		|:-------------:	| :-----:
| www.reddit.com      	| 2 | 1.7.2,1.7.1
| www.washingtontimes.com/ | 2 | 1.4.2,1.4.4
| www.tudoseo.com/ | 10 | 1.6.2,1.7.2,1.7.1,1.6.4,1.8.2,<br/>1.4.2,1.10.1,1.4.4,1.9.0,1.8.3

*Table: Duplicate loading of jQuery, source: example Google Big Query on HTTP Archive for the month of July 2014*

Why would you want to load more than one version of jQuery? Isn't this screaming for a good clean-up? There is definitely some legacy code in there that might require an older version of jQuery. Hence, the temptation is pretty big to just add a new version in addition to use newer functionality in jQuery. That seems like a lot of maintenance and legacy trouble. Instead, take some time, go through the functionality of your site and determine which version to convert to.

While sometimes, there might be a good reason to include several JavaScript frameworks, there could also be other reasons that should be verified. The overlapping and duplication of plugins can stem from different reasons.

* The team building the site didn't agree on a common framework or library to use
* Tangled code that developers have to work with. Sometimes they are only being provided with isolated include files, with very little visibility to the parent code. They could be tempted to just plug in their preferred library and version if needed, to continue their work
* Missing enforcement techniques
* Carelessness or laziness of developers
* Use of other web components including the same frameworks

SM: Are you going to to discuss frameworks etc in more detail later? If so, I would recommend slimming this section down to bring it more in line with the others, and just briefly cover the issues.
BB: I removed some of the CBC related stuff but I'm not planning on talking too much more about this later, rather more generally in the context of 3rd party scripts. I agree it's more content than the other temptation sections but I wonder if I moved some of this stuff to a later chapter, wouldn't this sound too repetitive bringing this topic up again later? SM, looking for your suggestion from you. Or should we see how chapter 4 plays out and move accordingly later?

#### Social media, ads and tracking
If you work for a company with a business intelligence, analytics or marketing department, the chances are high that you are being asked to include anything that could help measure the company's success. There is not one social media or tracking tool out there that marketing wouldn't like to try out. I will go into more detail on how to properly and securely include third-party scripts and plugins in chapter 4. But for now, let me say social media, ads and tracking scripts are big temptations for marketers and companies to better understand their customers and to add or find other revenue stream, e.g by selling ads. On the other hand, any foreign content you add on top of your own content, especially if it's JavaScript will add weight and load time to your page. 

However, your [rule of thumb](https://developers.google.com/events/io/2012/sessions/gooio2012/802/) should be that the value you get from using a third party script has to be greater than its performance hit. 


### Cool down

We've learned concepts around the psychology and performance, the perception of speed, what it means to be slow, as well as an overview of sweet temptations that could bloat our websites.

This book will cover all of the mentioned temptations above, with more detail and suggestions how to avoid those.

I promise you won't have to starve your website when resisting these temptations.
